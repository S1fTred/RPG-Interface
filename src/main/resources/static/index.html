<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Tabletop RPG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- –í–ê–ñ–ù–û: –æ–¥–∏–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π CSS -->
    <link rel="stylesheet" href="/styles.css" />
    <style>.hidden{display:none}</style>
</head>

<body>
<header class="topbar">
    <div class="brand">üíÄ Tabletop RPG</div>
    <nav id="top-nav">
        <button class="btn" id="btnLoginNav">–í–æ–π—Ç–∏</button>
        <button class="btn" id="btnRegisterNav">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button class="btn ghost hidden" id="btnLogoutNav">‚Ü™Ô∏é –í—ã–π—Ç–∏</button>
    </nav>
</header>

<main class="container">

    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <section id="view-welcome" class="view">
        <div class="card">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.</p>
        </div>
    </section>

    <!-- –í—Ö–æ–¥ -->
    <section id="view-login" class="view hidden">
        <form id="loginForm" class="card" autocomplete="on">
            <h2>–í—Ö–æ–¥</h2>
            <div id="loginError" class="form-error hidden"></div>
            <input id="loginUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
            <input id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" type="password" />
            <div class="row">
                <button id="loginSubmit" type="button" class="btn primary">–í–æ–π—Ç–∏</button>
                <button id="goRegister" type="button" class="btn ghost">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
        </form>
    </section>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <section id="view-register" class="view hidden">
        <form id="registerForm" class="card" autocomplete="off">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div id="registerError" class="form-error hidden"></div>
            <input id="regUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
            <input id="regEmail" placeholder="Email" type="email" />
            <input id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" type="password" />
            <div class="row">
                <button id="registerSubmit" type="button" class="btn primary">
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
                <button id="goLoginFromRegister" type="button" class="btn ghost">
                    –£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                </button>
            </div>
        </form>
    </section>

    <!-- –î–æ–º–æ–π (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞) -->
    <section id="view-home" class="view hidden">
        <div class="card">
            <h2>–í—ã –≤–æ—à–ª–∏</h2>
            <p>–ù–∏–∂–µ ‚Äî –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ: –∫–∞–º–ø–∞–Ω–∏–∏ (–∫–∞–∫ GM) –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏.</p>
        </div>

        <div class="card">
            <h3>–ú–æ–∏ –∫–∞–º–ø–∞–Ω–∏–∏</h3>
            <div id="home-campaigns-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div class="card">
            <h3>–ú–æ–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
            <div id="home-characters-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </section>

</main>

<footer class="footer">¬© Tabletop RPG Interface</footer>

<!-- –ú–æ–¥—É–ª–∏ —Ç–≤–æ–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–∞ -->
<script type="module">
    import { login, register, me, signout, boot } from '/js/auth.js';
    // –î–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ app.js, –∫–æ—Ç–æ—Ä–∞—è –¥–µ—Ä–≥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∫–∞–º–ø–∞–Ω–∏–π/–ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:
    // export async function loadHomeData() { ... }
    import { loadHomeData } from '/js/app.js';

    // –£—Ç–∏–ª–∏—Ç–∞ –ø–æ–∫–∞–∑–∞ —Å–µ–∫—Ü–∏–π
    function show(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.querySelector(id)?.classList.remove('hidden');
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–∫–Ω–æ–ø–∫–∏)
    function syncNav() {
        const logged = !!me();
        document.getElementById('btnLoginNav').classList.toggle('hidden', logged);
        document.getElementById('btnRegisterNav').classList.toggle('hidden', logged);
        document.getElementById('btnLogoutNav').classList.toggle('hidden', !logged);
    }

    // –ü–µ—Ä–µ—Ö–æ–¥—ã –∏–∑ —à–∞–ø–∫–∏
    document.getElementById('btnLoginNav').onclick = () => show('#view-login');
    document.getElementById('btnRegisterNav').onclick = () => show('#view-register');
    document.getElementById('btnLogoutNav').onclick = () => {
        signout();
        syncNav();
        show('#view-welcome');
    };

    // –°—Å—ã–ª–∫–∏ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
    document.getElementById('goRegister').onclick = () => show('#view-register');
    document.getElementById('goLoginFromRegister').onclick = () => show('#view-login');

    // –í—Ö–æ–¥
    document.getElementById('loginSubmit').onclick = async () => {
        const u = document.getElementById('loginUsername').value.trim();
        const p = document.getElementById('loginPassword').value.trim();
        const errBox = document.getElementById('loginError');
        errBox.classList.add('hidden');
        try {
            await login(u, p);
            syncNav();
            show('#view-home');
            // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try { await loadHomeData(); } catch {}
        } catch (e) {
            errBox.textContent = e?.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
            errBox.classList.remove('hidden');
        }
    };

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    document.getElementById('registerSubmit').onclick = async () => {
        const u = document.getElementById('regUsername').value.trim();
        const e = document.getElementById('regEmail').value.trim();
        const p = document.getElementById('regPassword').value.trim();
        const errBox = document.getElementById('registerError');
        errBox.classList.add('hidden');
        try {
            await register(u, e, p); // –≤–Ω—É—Ç—Ä–∏ —Å—Ä–∞–∑—É –ª–æ–≥–∏–Ω
            syncNav();
            show('#view-home');
            try { await loadHomeData(); } catch {}
        } catch (er) {
            errBox.textContent = er?.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
            errBox.classList.remove('hidden');
        }
    };

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    await boot();
    syncNav();
    if (me()) {
        show('#view-home');
        try { await loadHomeData(); } catch {}
    } else {
        show('#view-welcome');
    }
</script>
</body>
</html>
